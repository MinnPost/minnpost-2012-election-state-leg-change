<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>MinnPost</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<script type="text/javascript">var _sf_startpt=(new Date()).getTime()</script>
<link rel="shortcut icon" href="http://www.minnpost.com//sites/default/themes/siteskin/favicon.ico" type="image/x-icon" />
<meta name="keywords" content="Mark Dayton,Minnesota DFL,Minnesota GOP,Minnesota Legislature,Vikings Stadium,Voter ID Amendment" />
<meta name="description" content="  " />
<meta property="og:title" content="The 2012 Legislative session: What did they pass?"/>
<meta property="og:site_name" content="MinnPost"/>
<meta property="og:description" content="Explore bills by category, investigate which bills Gov. Dayton vetoed, and search by your legislators.
"/>
<meta property="og:image" content="http://www.minnpost.com/sites/default/files/images/thumbnails/fullpagearticles/BillExplorerGraphic3.png"/>
<link rel="apple-touch-icon" href="http://www.minnpost.com//sites/default/themes/siteskin/inc/images/apple-touch-icon.png" />
<meta name="viewport" content="width=device-width, initial-scale=1"></meta>


  <link type="text/css" rel="stylesheet" media="all" href="http://www.minnpost.com/sites/default/files/css/css_821e22b02514b6df405432d971d85dea.css" />
<link type="text/css" rel="stylesheet" media="screen" href="http://www.minnpost.com/sites/default/files/css/css_b26ad2d81bc74f1246e9c9a4c45ecdea.css" />
<link type="text/css" rel="stylesheet" media="print" href="http://www.minnpost.com/sites/default/files/css/css_cd72d16d00ebb27825710d934e28fbe8.css" />
  <!--[if IE]>
      <link rel="stylesheet" href="http://www.minnpost.com/sites/default/themes/derma/inc/css/ie.css?n" type="text/css">
  <![endif]-->
    <script type="text/javascript" src="http://www.minnpost.com/sites/default/files/js/js_de97366bf2ae2bb44590e7cf73e2a6d6.js"></script>
<script type="text/javascript" src="http://www.minnpost.com/sites/all/libraries/tinymce/jscripts/tiny_mce/tiny_mce.js?n"></script>
    

</head>
<body class="not-front logged-in page-node node-type-article one-sidebar sidebar-right admin-nw admin-vertical admin-df  section-data section-data-id-2012 section-data-id-2012-id-05 section-data-id-2012-id-05-how-we-built-legislative-bill-explorer one-sidebar sidebar-right">
<div class="outside-embeddable-container">




  <!-- START: Embeddable -->
  <div class="node-body fieldlayout node-field-body">
    <style type="text/css">
      @import url('https://s3.amazonaws.com/data.minnpost/js/qtip2-master-20121022/jquery.qtip.min.css');
    </style>
    
    <style type="text/css">
      #minnpost-2012-election-state-leg-change {
        max-width: 960px;
        margin: 0 auto;
      }
      .clear {
        clear: both;
      }
      .js-dependent,
      .hidden {
        display: none;
      }
      .footnote {
        font-size: .75em;
        font-style: italic;
        color: #414141;
        margin-top: 3em;
        border-top: 1px solid #BCBCBC;
        padding-top: 1em;
      }
      .loading-general {
        width: 100%;
        text-align: center;
        padding: 2em 2em;
        color: #ABABAB;
        vertical-align: middle;
        height: 100%;
        line-height: 100%;
      }
      .loading-general span {
        padding: 10px 5px 10px 40px;
        background: transparent url('https://s3.amazonaws.com/data.minnpost/projects/2012-mn-election-results/images/ajax-loader.gif') center left no-repeat;
        vertical-align: middle;
        height: 100%;
        line-height: 100%;
      }
      
      .viz-container {
        width: 50%;
        float: left;
      }
      
      .paper-container {
        width: 100%;
        height: 300px;
      }
      
      .chart-labels {
        text-transform: capitalize;
      }
      .chart-labels span {
        font-family: Helvetica,Arial,Geneva,sans-serif;
      }
      
      .tooltip-container h3 {
        margin-bottom: 1em;
      }
      
      /**
       * Responsive screen size styles
       */
      @media screen and (max-width: 768px) {
      }
    </style>
    
    <!--[if lte IE 7]>
    <![endif]-->
    
    
    
    <!-- Initial HTML for application -->
    <div id="minnpost-2012-election-state-leg-change">
      <noscript>
        <p>This application requires Javascript which is used to make your web browser more interactive.  If this message does not go away, please consider enabling Javascript.  Here are <a href="http://www.enable-javascript.com/" target="_blank">instructions on how to enable JavaScript in your web browser</a>.</p>
      </noscript>
      
      <!--[if lt IE 7]>
        <div class="ie-upgrade-note">
          <h4>Consider upgrading your browser</h4>
          <p>Your <strong>Internet Browser</strong> is the application you use to navigate webpages on the internet.  You are currently using an older version of Internet Explorer.  Unfortunately, with this old browser, you will not be able to experience the full version of this interactive story.</p>
          
          <p><a href="http://browsehappy.com/" target="_blank">Click here to find out about options for newer browsers</a>.</p>
        
          <p>If you cannot install new applications on your computer (because you are at work, for example), consider using <a href="http://www.google.com/chromeframe" target="_blank">Google's Chrome Frame</a> for Internet Explorer.</p>
        </div>
      <![endif]-->
      
      <div id="chart-container">
      </div>
      
      <p class="footnote">Data from multiple sources, including <a href="http://www.leg.state.mn.us/" target="_blank">MN State Legislature</a>.</p>
    </div>
    
    <!-- Templates to be used in client side processing. -->
    <script id="template-loading" type="text/template">
      <div class="loading-general-container">
        <div class="loading-general"><span>Loading...</span></div>
      </div>
    </script>
    
    <script id="template-service-down" type="text/template">
      <h3>We are sorry</h3>
      <p>The data service seems to be down or you no longer have access to the Internet.  Try refreshing the page or checking your Internet connection.</p>
    </script>
    
    <script id="template-application" type="text/template">
      <div class="clear-block">
        <div class="viz-container senate-2011-container">
          <h3>Senate 2011</h3>
          <div id="senate-2011-paper" class="paper-container"></div>
        </div>
        <div class="viz-container senate-2013-container">
          <h3>Senate 2013</h3>
          <div id="senate-2013-paper" class="paper-container"></div>
        </div>
        <div class="viz-container house-2011-container">
          <h3>House 2011</h3>
          <div id="house-2011-paper" class="paper-container"></div>
        </div>
        <div class="viz-container house-2013-container">
          <h3>House 2013</h3>
          <div id="house-2013-paper" class="paper-container"></div>
        </div>
      </div>
    </script>
    
    <script id="template-chart-labels" type="text/template">
      <div class="chart-labels">
        <% var count = 0; %>
        <% for (var i in g) { %>
          <%= i %>:
          <% g[i] = _.sortBy(g[i], 'party'); for (var j = 0, l = g[i].length; j < l; j++) { %>
            <span style="color: <%= g[i][j].partyColor %>;">
              <%= g[i][j].children.length %>
            </span>
            <% if (j < l - 1) { %>-<% } %>
          <% } %>
          <% count++; if (count < _.size(g)) { %>|<% } %>
        <% } %>
      </div>
    </script>
    
    <script id="template-tooltip" type="text/template">
      <div class="tooltip-container">
        <h3>
          <%= d.name %> 
          (<span style="color: <%= d.partyColor %>"><%= d.party %></span>)
        </h3>
        <table>
          <tbody>
            <% if (!_.isUndefined(d.elected) && d.elected !== '') { %>
              <tr><td>First elected:</td><td><%= d.elected %></td>
            <% } %>
            <% if (!_.isUndefined(d.children) && _.isArray(d.children)) { %>
              <tr><td>Legislators:</td><td><%= d.children.length %></td>
            <% } %>
            <% if (!_.isUndefined(d.previous_terms) && d.previous_terms !== '') { %>
              <tr><td>Previous terms:</td><td><%= d.previous_terms %></td>
            <% } %>
            <% if (!_.isUndefined(d.incumbent) && d.incumbent !== '') { %>
              <tr><td>Incumbent:</td><td>Yes</td>
            <% } %>
          </tbody>
        </table>
      </div>
    </script>
  
    <!-- jQuery that is used on MinnPost site (ensures test environment) -->
    <script type="text/javascript">
      window.jQuery || document.write('<script type="text/javascript" src="https://s3.amazonaws.com/data.minnpost/js/jquery-1.3.2/jquery-1.3.2.min.js"><\/script>')
    </script>
    
    <!--[if lte IE 8]>
      <script type="text/javascript" src="https://s3.amazonaws.com/data.minnpost/js/es5-shim-master-20120801/es5-shim.min.js"></script>
    <![endif]-->
    
    <!-- jQuery we want to use -->
    <script type="text/javascript" src="https://s3.amazonaws.com/data.minnpost/js/underscore-1.3.3/underscore-min.js"></script>
    <script type="text/javascript" src="https://s3.amazonaws.com/data.minnpost/js/jquery-custom-master-20120606/jquery-1.7.2.custom.min.js"></script>
    <script type="text/javascript" src="https://s3.amazonaws.com/data.minnpost/js/qtip2-master-20121022/jquerycustom.qtip.min.js"></script>
    <script type="text/javascript" src="https://s3.amazonaws.com/data.minnpost/js/raphael-2.1.0/raphael-min.js"></script>
    <script type="text/javascript" src="https://s3.amazonaws.com/data.minnpost/js/d3-2.10.3/builds/d3.core.min.js"></script>
    <script type="text/javascript" src="https://s3.amazonaws.com/data.minnpost/js/d3-2.10.3/builds/d3.layout.min.js"></script>

    
    
    <script type="text/javascript">
      // Handle custom jQuery
      jQueryCustom = jQueryCustom.noConflict();
      
      (function($, w, undefined) {
        var dataURL = 'https://s3.amazonaws.com/data.minnpost/projects/minnpost-2012-election-state-leg-change/data/data.jsonp';
        var dataContainer = {};
        var templateLoading = $('#template-loading').html();
        var templateTooltip = $('#template-tooltip').html();
        var templateApplication = $('#template-application').html();
        var templateDown = $('#template-service-down').html();
        var templateLabel = $('#template-chart-labels').html();
        
        // For local testing
        if (location.host.indexOf('localhost') !== -1) {
          dataURL = './data/data.jsonp';
        }
        
        // Party colors
        var parties = {
          'IP': { party: 'IP', colors: [ '#FF7429' ], title: 'Independence' },
          'R': { party: 'R', colors: [ '#AD001A' ], title: 'Republican' },
          'DFL': { party: 'DFL', colors: [ '#0071AC' ], title: 'Democratic' },
          'D': { party: 'D', colors: [ '#0071AC' ], title: 'Democratic-Farmer-Labor' },
          'NP': { party: 'NP', colors: [ '#A8A8A8' ], title: 'Nonpartisan' }
        };
        
        // Types
        var typesTranslator = {
          'new': { title: 'New', lighten: 0 },
          'incumbent': { title: 'Incumbent', lighten: -0.2 },
          'returning': { title: 'Returning', lighten: -0.5 }
        };
        
        // Color functions
        var lighten = function(color, amount) {
          amount = amount || 0.2;
          var rgb = Raphael.getRGB(color);
          var hsb = Raphael.rgb2hsb(rgb.r, rgb.g, rgb.b);
          var s = 'hsb(' + hsb.h + ', ' + hsb.s + ', ' + (hsb.b + amount) + ')';
          var newrgb = Raphael.getRGB(s);
          return newrgb.hex;
        };
        
        // Object/class for handling candidates
        var NewCandidate = function(d) {
          // Parse data
          this.district = d.district || '';
          this.name = d.name || '';
          this.party = d.party || 'NP';
          this.incumbent = (_.isBoolean(d.incumbent)) ? d.incumbent : 
            ((_.isString(d.incumbent) && d.incumbent.indexOf('Incum') !== -1) ? true : false);
          this.elected = d.elected || '';
          this.previous_terms = d.previous_terms || '';
          this.selectedYear = d.selectedYear || '';
          this.type = 'none';
          
          this.init();
        };
        NewCandidate.prototype.init = function() {
          // Process data
          this.type = (this.incumbent) ? 'incumbent' : this.type;
          this.type = (!this.incumbent && this.previous_terms !== '') ? 'returning' : this.type;
          this.type = (!this.incumbent && this.elected === this.selectedYear && this.previous_terms === '') 
            ? 'new' : this.type;
          
          this.partyColor = (this.party && parties[this.party]) ? parties[this.party].colors[0] : '#DCDCDC';
        }
        
        var drawChamber = function(data, set, el) {
          var $el = $('#' + el);
          var w = $el.width();
          var h = $el.height();
          var selectedYear = (set.indexOf('2013') !== -1) ? '2012' : '2010';
          
          // Process data into what D3 likes
          candidates = {};
          _.each(data, function(d) {
            d.selectedYear = selectedYear;
            d = new NewCandidate(d);
            var group = d.type + '-' + d.party;
            candidates[group] = candidates[group] || {
              name: typesTranslator[d.type].title,
              type: d.type,
              party: d.party,
              partyColor: d.partyColor,
              children: []
            };
            candidates[group].children.push(d);
          });
          candidates = { name: 'Candidates', children: _.toArray(candidates) };
          
          // Use D3 pack layout
          var pack = d3.layout.pack()
            .padding(7)
            .size([w, h])
            .value(function(d) { return 1; });
          var packed = pack.nodes(candidates);
          
          // Make labels.
          var groups = _.filter(packed, function(p) { return (p.depth === 1); });
          groups = _.groupBy(groups, 'type');
          $el.before(_.template(templateLabel, { g: groups }));

          // Render with Raphael
          var paper = Raphael(el, w, h);
          _.each(packed, function(p, i) {
            var attr = {};
            
            // Determine colors and other attributes for circles
            if (p.depth <= 1) {
              attr.fill = '#FFFFFF';
              attr['stroke-width'] = 0;
            }
            if (p.depth == 1) {
              attr.fill = (p.party && parties[p.party]) ? parties[p.party].colors[0] : '#DCDCDC';
              attr.fill = lighten(attr.fill, typesTranslator[p.type].lighten);
              attr.opacity = 0.2;
              p.r += 2;
            }
            if (p.depth >= 2) {
              attr['stroke-width'] = 0;
              attr.fill = (p.party && parties[p.party]) ? parties[p.party].colors[0] : '#DCDCDC'
            }
            
            // Make circle
            packed[i].circle = paper.circle(p.x, p.y, p.r).attr(attr);
            
            // Add hover
            if (p.depth !== 0) {
              $(packed[i].circle.node).qtip({
                content: {
                  text: _.template(templateTooltip, { d: p })
                },
                style: {
                  classes: 'ui-tooltip-shadow ui-tooltip-light'
                },
                position: {
                  at: 'top center',
                  my: 'bottom center'
                }
              });
            }
          });
        };
        
        // Function for handling data after it is loaded
        var processData = function(data) {
          // Reset container
          $('#chart-container').html(_.template(templateApplication, {}));
          
          _.each(data, function(d, i) {
            drawChamber(d, i, i + '-paper');
          });
        };
        
        // Kick it off.
        $('#chart-container').html(_.template(templateLoading, {}));
        window.legCallback = function(data) {
          processData(data);
        };
        $.ajax({
          type: 'GET',
          dataType: 'jsonp',
          url: dataURL,
          jsonp: 'callback'
        });
      })(jQueryCustom, window);
    </script>
  </div>
  <!-- END: Embeddable -->




</div>
</body>
</html>